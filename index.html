<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“¦ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: Arial; text-align: center; direction: rtl; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f2f2f2; }
    video { width: 100%; max-width: 400px; margin: auto; }
  </style>
</head>
<body>
  <h1>ðŸ“¦ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h1>

  <button onclick="startCamera()">ðŸ“· Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
  <div id="reader" style="width: 300px; height: 300px; margin: 20px auto;"></div>

  <h2>ðŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
  <table id="productsTable">
    <tr>
      <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
      <th>Ø§Ù„Ø§Ø³Ù…</th>
      <th>Ø§Ù„Ø³Ø¹Ø±</th>
    </tr>
  </table>

  <script>
    const html5QrCode = new Html5Qrcode("reader");

    function startCamera() {
      Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
          const cameraId = devices[0].id;
          html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            qrCodeMessage => {
              onBarcodeScanned(qrCodeMessage);
              html5QrCode.stop();
            },
            errorMessage => {}
          );
        }
      }).catch(err => {
        console.error("Camera error:", err);
      });
    }

    function onBarcodeScanned(code) {
      const products = JSON.parse(localStorage.getItem("products") || "{}");

      if (products[code]) {
        const product = products[code];
        addToTable(code, product.name, product.price);
      } else {
        const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:");
        const price = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±:");
        if (name && price) {
          products[code] = { name, price };
          localStorage.setItem("products", JSON.stringify(products));
          addToTable(code, name, price);
        }
      }
    }

    function addToTable(barcode, name, price) {
      const table = document.getElementById("productsTable");
      const row = table.insertRow(-1);
      row.insertCell(0).innerText = barcode;
      row.insertCell(1).innerText = name;
      row.insertCell(2).innerText = price;
    }

    window.onload = function () {
      const products = JSON.parse(localStorage.getItem("products") || "{}");
      for (const [code, info] of Object.entries(products)) {
        addToTable(code, info.name, info.price);
      }
    };
  </script>
</body>
</html>
